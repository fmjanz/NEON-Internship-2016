install.packages("MGRASTer")
install.packages("RJSONIO")
url <- as.character("http://api.metagenomics.anl.gov/1/download/")
mgID <- as.character("4637812.3")
APIobj <- call.MGRAST(url,id=mgID,file=350.1)
install.packages("vegan")
setwd("D:\NEON2\")
setwd("C:\Users\fjanz\Documents")
setwd("C:/Users/fjanz/Documents")
file1 <- read.csv("mgm4637809.3.RS.species.csv",sep='\t')
file1 <- read.csv("mgm4637809.3.RS.species.csv",sep='\t',header=F)
View(file1)
library('stringr')
library('lessR') #for Sort()
library('vegan') #ecology functions
library("dplyr")
mergeData <- function(fileA, fileB){
combinedData <- merge(x = fileA, y = fileB, by="Taxonomy", all=TRUE)
combinedData[is.na(combinedData)] <- 0 #replace NAs with 0s
return(combinedData)
}
#removes uneeded columns
cleanFile <- function(afile){
afile <- afile[,-4] #delete phantom empty column
afile <- afile[,-1] #delete taxon column
return(afile)
}
#filters out non-microbial genomic data
cleanTaxon <- function (df){
df <- filter(df,grepl("virus",df$Taxonomy)==FALSE)
df <- filter(df,grepl("Eukaryota",df$Taxonomy)==FALSE)
df <- filter(df,grepl("Eukaryota",df$Taxonomy)==FALSE)
df <- filter(df,grepl("unclassified",df$Taxonomy)==FALSE)
return(df)
}
fill.taxonomy.newMG <- function(x) {
### Parses taxon names in abundance table. Specific for 'new' MG-RAST output
### tables with structure "metagenomeID.DB.taxonlevel.csv"
### Table should be read in as tab-separated .csv file.
### By Lee Stanish June 27, 2016
tax <- x[,1]
alltax <- str_split_fixed(as.character(tax), pattern=";",n=7)
colnames(alltax) <- c("domain", "phylum", "class", "order", "family","genus", "species")
alltax <- data.frame(alltax)
return(alltax)
}
t.otu <- function(x, s, e) {
## Written by Lee Stanish
## transpose OTU table for ordination analysis##
## x=OTU table; s=starting column; e=ending column
x <- as.data.frame(x)
x1 <- t(x[,c(s:e)])      # transpose OTU counts
colnames(x1) <- x[,1]     #replace OTU ids as column names
x1
}
#creates 6 side-by-side graphs for data; specify colors as strings
makeGraphs <- function(color1,color2,color3,color4){
leg <- c("Individual", "Composite") #legend names
par(mfrow=c(2,3))
sites <- c("CPER","DSNY","HARV","OSBS","STER","TALL")
for (i in 1:length(sites)){
barplot(div[metadataDF$siteIDs==sites[i]],width=0.45,beside = TRUE,ylim=c(5.6,6.25),xlab=sites[i],ylab="Shannon Index",
legend.text = leg, horiz=F,xpd=F, las=1, col=c(color1,color2),cex.lab = 1.5, cex.main = 1.4)
}
for (i in 1:length(sites)){
barplot(abundance[metadataDF$siteIDs==sites[i]],width=0.45,beside = TRUE,ylim=c(1590,1760),xlab=sites[i],ylab="Species Richness",
legend.text = leg, horiz=F,xpd=F, las=1, col=c(color3,color4),cex.lab = 1.5, cex.main = 1.4)
}
}
setwd("C:/Users/fjanz/Documents/GitHub/NEON-Internship-2016/metagenome_tables/OTUtables/MGdata")
#tell R where to look for things
directory <- ("C:/Users/fjanz/Documents/GitHub/NEON-Internship-2016/metagenome_tables/OTUtables/MGdata")
files <- list.files(directory, full.names = FALSE)
testFile <- readLines(files[1],2539)
file1 <- read.table(files[1],quote = "", sep='\t',header=TRUE, skip = 2)
file2 <- read.table(files[2],quote = "", sep='\t',header=TRUE, skip = 2)
file1 <- cleanFile(file1)
file2 <- cleanFile(file2)
#combine first two files
MGotu <- as.data.frame(mergeData(file1,file2))
END <- length(files)
#read in and merge remaining files
for (i in 3:END){
tempfile <- read.table(files[i], quote = "", sep="\t", skip = 2,header = TRUE)
tempfile <- cleanFile(tempfile)
MGotu <- as.data.frame(mergeData(MGotu,tempfile))
}
#filter unwanted data
MGotu <- cleanTaxon(MGotu)
#split out taxonomic info
MGtaxa <- fill.taxonomy.newMG(MGotu)
#transpose columns and rows and organize to prep for diversity analysis
MGotu_flip <- t.otu(x=MGotu,s=2,e=END)
MGotu_flip <- Sort(by=row.names,data=MGotu_flip)
setwd("C:/Users/fjanz/Documents/GitHub/NEON-Internship-2016/metagenome_tables/OTUtables/Cdata")
directory <- ("C:/Users/fjanz/Documents/GitHub/NEON-Internship-2016/metagenome_tables/OTUtables/Cdata")
files <- list.files(directory, full.names = FALSE)
file1 <- read.table(files[1],quote = "", sep='\t', skip = 2, header=TRUE)
file2 <- read.table(files[2],quote = "", sep="\t", skip = 2, header = TRUE)
file1 <- cleanFile(file1)
file2 <- cleanFile(file2)
Cotu <- mergeData(file1,file2)
END2 <- length(files)
for (i in 3:END2){
tempfile <- read.table(files[i], quote = "", sep="\t", skip = 2, header = TRUE)
tempfile <- cleanFile(tempfile)
Cotu <- mergeData(Cotu,tempfile)
}
Cotu <- cleanTaxon(Cotu)
Ctaxa <- fill.taxonomy.newMG(Cotu)
Cotu_flip <- t.otu(x=Cotu,s=2,e=END2)
Cotu_flip <- Sort(by=row.names,data=Cotu_flip)
Cdiv <- (rep(0,END2-1))
abundanceC <- (rep(0,END2-1))
for (i in 1:(END2-1)){
Cdiv[i] <- diversity(as.numeric(Cotu_flip[i,]))
abundanceC[i] <- specnumber(Cotu_flip[i,])
}
MGdiv <- (rep(0,END-1))
abundanceM <- (rep(0,END-1))
for (i in 1:(END-1)){
MGdiv[i] <- diversity(as.numeric(MGotu_flip[i,]))
abundanceM[i] <- specnumber(MGotu_flip[i,])
}
#convert diversity measures to data frames
Cdiv <- as.data.frame(Cdiv)
MGdiv <- as.data.frame(MGdiv)
abundanceC <- as.data.frame(abundanceC)
abundanceM <- as.data.frame(abundanceM)
#add names for merging
MGplotnames <- rownames(MGotu_flip)
Cplotnames <- rownames(Cotu_flip)
rownames(MGdiv) <- MGplotnames
rownames(Cdiv) <- Cplotnames
rownames(abundanceM) <- MGplotnames
rownames(abundanceC) <- Cplotnames
View(abundanceM)
View(abundanceC)
div <- merge(MGdiv,Cdiv)
View(div)
View(Cdiv)
View(MGdiv)
div <- cbind(MGdiv,Cdiv)
View(div)
abundance <- cbind(abundanceM,abundanceC)
View(abundance)
plotnames <- rownames(div)
siteIDs <- rep(NA, length(plotnames))
for (i in 1:length(plotnames)){
siteIDs[i] <- substr(plotnames[i],1,4)
}
metadata <- cbind(plotnames,siteIDs)
metadataDF <- as.data.frame(metadata)
makeGraphs("tomato","tan","seashell","sandybrown")
View(metadataDF)
View(MGdiv)
View(Cdiv)
abundance <- as.matrix(cbind(abundanceM,abundanceC))
div <- as.matrix(cbind(MGdiv,Cdiv))
makeGraphs("tomato","tan","seashell","sandybrown")
View(abundance)
View(abundanceC)
View(abundanceM)
View(div)
View(Cdiv)
View(MGdiv)
makeGraphs <- function(color1,color2,color3,color4){
leg <- c("Individual", "Composite") #legend names
par(mfrow=c(2,3))
sites <- c("CPER","DSNY","HARV","OSBS","STER","TALL")
for (i in 1:length(sites)){
barplot(div[metadataDF$siteIDs==sites[i]],width=0.45,beside = TRUE,ylim=c(5.6,6.25),xlab=sites[i],ylab="Shannon Index",
legend.text = leg, horiz=F,xpd=F, las=1, col=c(color1,color2),cex.lab = 1.5, cex.main = 1.4)
text(labels=as.character(div))
}
for (i in 1:length(sites)){
barplot(abundance[metadataDF$siteIDs==sites[i]],width=0.45,beside = TRUE,ylim=c(1590,1760),xlab=sites[i],ylab="Species Richness",
legend.text = leg, horiz=F,xpd=F, las=1, col=c(color3,color4),cex.lab = 1.5, cex.main = 1.4)
text(labels=as.character(abundance))
}
}
makeGraphs("tomato","tan","seashell","sandybrown")
makeGraphs <- function(color1,color2,color3,color4){
leg <- c("Individual", "Composite") #legend names
par(mfrow=c(2,3))
sites <- c("CPER","DSNY","HARV","OSBS","STER","TALL")
for (i in 1:length(sites)){
barplot(div[metadataDF$siteIDs==sites[i]],width=0.45,beside = TRUE,ylim=c(5.6,6.25),xlab=sites[i],ylab="Shannon Index",
legend.text = leg, horiz=F,xpd=F, las=1, col=c(color1,color2),cex.lab = 1.5, cex.main = 1.4)
text(div,labels=as.character(div))
}
for (i in 1:length(sites)){
barplot(abundance[metadataDF$siteIDs==sites[i]],width=0.45,beside = TRUE,ylim=c(1590,1760),xlab=sites[i],ylab="Species Richness",
legend.text = leg, horiz=F,xpd=F, las=1, col=c(color3,color4),cex.lab = 1.5, cex.main = 1.4)
text(abundance,labels=as.character(abundance))
}
}
makeGraphs("tomato","tan","seashell","sandybrown")
makeGraphs <- function(color1,color2,color3,color4){
leg <- c("Individual", "Composite") #legend names
par(mfrow=c(2,3))
sites <- c("CPER","DSNY","HARV","OSBS","STER","TALL")
for (i in 1:length(sites)){
barplot(div[metadataDF$siteIDs==sites[i]],width=0.45,beside = TRUE,ylim=c(5.6,6.25),xlab=sites[i],ylab="Shannon Index",
legend.text = leg, horiz=F,xpd=F, las=1, col=c(color1,color2),cex.lab = 1.5, cex.main = 1.4)
text(div,labels=as.character(div),cex = 1,pos = 3)
}
for (i in 1:length(sites)){
barplot(abundance[metadataDF$siteIDs==sites[i]],width=0.45,beside = TRUE,ylim=c(1590,1760),xlab=sites[i],ylab="Species Richness",
legend.text = leg, horiz=F,xpd=F, las=1, col=c(color3,color4),cex.lab = 1.5, cex.main = 1.4)
text(abundance,labels=as.character(abundance),cex=1, pos=3)
}
}
makeGraphs("tomato","tan","seashell","sandybrown")
div[metatdataDF$siteIDs==sites[1]]
div[metadataDF$siteIDs==sites[1]]
sites <- c("CPER","DSNY","HARV","OSBS","STER","TALL")
div[metadataDF$siteIDs==sites[1]]
length(div[metadata$siteIDs==sites[1]])
length(div[metadataDF$siteIDs==sites[1]])
makeGraphs <- function(color1,color2,color3,color4){
leg <- c("Individual", "Composite") #legend names
par(mfrow=c(2,3))
sites <- c("CPER","DSNY","HARV","OSBS","STER","TALL")
for (i in 1:length(sites)){
barplot(div[metadataDF$siteIDs==sites[i]],width=0.45,beside = TRUE,ylim=c(5.6,6.25),xlab=sites[i],ylab="Shannon Index",
legend.text = leg, horiz=F,xpd=F, las=1, col=c(color1,color2),cex.lab = 1.5, cex.main = 1.4)
l <- length(div[metadataDF$siteIDs==sites[i]])
xloc <- seq(1,l)
text(xloc,labels=round(div),cex = 1,pos = 3)
}
for (i in 1:length(sites)){
barplot(abundance[metadataDF$siteIDs==sites[i]],width=0.45,beside = TRUE,ylim=c(1590,1760),xlab=sites[i],ylab="Species Richness",
legend.text = leg, horiz=F,xpd=F, las=1, col=c(color3,color4),cex.lab = 1.5, cex.main = 1.4)
l <- length(div[metadataDF$siteIDs==sites[i]])
xloc <- seq(1,l)
text(xloc,labels=round(div),cex = 1,pos = 3)
}
}
makeGraphs("tomato","tan","seashell","sandybrown")
makeGraphs <- function(color1,color2,color3,color4){
leg <- c("Individual", "Composite") #legend names
par(mfrow=c(2,3))
sites <- c("CPER","DSNY","HARV","OSBS","STER","TALL")
for (i in 1:length(sites)){
barplot(div[metadataDF$siteIDs==sites[i]],width=0.45,beside = TRUE,ylim=c(5.6,6.25),xlab=sites[i],ylab="Shannon Index",
legend.text = leg, horiz=F,xpd=F, las=1, col=c(color1,color2),cex.lab = 1.5, cex.main = 1.4)
l <- length(div[metadataDF$siteIDs==sites[i]])
xloc <- seq(1,l)
text(xloc,labels=round(div),cex = 1,pos = 3)
}
for (i in 1:length(sites)){
barplot(abundance[metadataDF$siteIDs==sites[i]],width=0.45,beside = TRUE,ylim=c(1590,1760),xlab=sites[i],ylab="Species Richness",
legend.text = leg, horiz=F,xpd=F, las=1, col=c(color3,color4),cex.lab = 1.5, cex.main = 1.4)
l <- length(abundance[metadataDF$siteIDs==sites[i]])
xloc <- seq(1,l)
text(xloc,labels=round(abudance),cex = 1,pos = 3)
}
}
makeGraphs("tomato","tan","seashell","sandybrown")
makeGraphs <- function(color1,color2,color3,color4){
leg <- c("Individual", "Composite") #legend names
par(mfrow=c(2,3))
sites <- c("CPER","DSNY","HARV","OSBS","STER","TALL")
for (i in 1:length(sites)){
barplot(div[metadataDF$siteIDs==sites[i]],width=0.45,beside = TRUE,ylim=c(5.6,6.25),xlab=sites[i],ylab="Shannon Index",
legend.text = leg, horiz=F,xpd=F, las=1, col=c(color1,color2),cex.lab = 1.5, cex.main = 1.4)
l <- length(div[metadataDF$siteIDs==sites[i]])
xloc <- seq(1,l)
text(xloc,labels=round(div),cex = 1,pos = 3)
}
for (i in 1:length(sites)){
barplot(abundance[metadataDF$siteIDs==sites[i]],width=0.45,beside = TRUE,ylim=c(1590,1760),xlab=sites[i],ylab="Species Richness",
legend.text = leg, horiz=F,xpd=F, las=1, col=c(color3,color4),cex.lab = 1.5, cex.main = 1.4)
l <- length(abundance[metadataDF$siteIDs==sites[i]])
xloc <- seq(1,l)
text(xloc,labels=round(abundance),cex = 1,pos = 3)
}
}
makeGraphs("tomato","tan","seashell","sandybrown")
makeGraphs <- function(color1,color2,color3,color4){
leg <- c("Individual", "Composite") #legend names
par(mfrow=c(2,3))
sites <- c("CPER","DSNY","HARV","OSBS","STER","TALL")
for (i in 1:length(sites)){
barplot(div[metadataDF$siteIDs==sites[i]],width=0.45,beside = TRUE,ylim=c(5.6,6.25),xlab=sites[i],ylab="Shannon Index",
legend.text = leg, horiz=F,xpd=F, las=1, col=c(color1,color2),cex.lab = 1.5, cex.main = 1.4)
}
for (i in 1:length(sites)){
barplot(abundance[metadataDF$siteIDs==sites[i]],width=0.45,beside = TRUE,ylim=c(1590,1760),xlab=sites[i],ylab="Species Richness",
legend.text = leg, horiz=F,xpd=F, las=1, col=c(color3,color4),cex.lab = 1.5, cex.main = 1.4)
}
}
makeGraphs("tomato","tan","seashell","sandybrown")
View(abundance)
colors()
makeGraphs("slateblue1","slategray1","sandybrown","seashell")
makeGraphs("thistle","wheat4","sandybrown","seashell")
makeGraphs("palegoldenrod","navajowhite2","sandybrown","seashell")
makeGraphs("palegoldenrod","whitesmoke","sandybrown","seashell")
makeGraphs("darkgoldenrod1","whitesmoke","sandybrown","seashell")
makeGraphs("darkgoldenrod1","snow3","sandybrown","seashell")
makeGraphs("wheat","whitesmoke","sandybrown","seashell")
makeGraphs("wheat1","whitesmoke","sandybrown","seashell")
makeGraphs("wheat2","whitesmoke","sandybrown","seashell")
makeGraphs("wheat3","whitesmoke","sandybrown","seashell")
makeGraphs("wheat3","whitesmoke","sandybrown","seashell")
View(div)
makeGraphs <- function(color1,color2,color3,color4){
leg <- c("Individual", "Composite") #legend names
par(mfrow=c(2,3))
sites <- c("CPER","DSNY","HARV","OSBS","STER","TALL")
for (i in 1:(length(sites)-1)){
barplot(div[metadataDF$siteIDs==sites[i]],width=0.45,beside = TRUE,ylim=c(5.6,6.25),xlab=sites[i],ylab="Shannon Index",
horiz=F,xpd=F, las=1, col=c(color1,color2),cex.lab = 1.5, cex.main = 1.4)
}
barplot(div[metadataDF$siteIDs==sites[4]],width=0.45,beside = TRUE,ylim=c(5.6,6.25),xlab=sites[i],ylab="Shannon Index",
legend.text = leg, horiz=F,xpd=F, las=1, col=c(color1,color2),cex.lab = 1.5, cex.main = 1.4)
for (i in 1:(length(sites)-1)){
barplot(abundance[metadataDF$siteIDs==sites[i]],width=0.45,beside = TRUE,ylim=c(1590,1760),xlab=sites[i],ylab="Species Richness",
horiz=F,xpd=F, las=1, col=c(color3,color4),cex.lab = 1.5, cex.main = 1.4)
}
barplot(abundance[metadataDF$siteIDs==sites[4]],width=0.45,beside = TRUE,ylim=c(1590,1760),xlab=sites[i],ylab="Species Richness",
legend.text = leg, horiz=F,xpd=F, las=1, col=c(color3,color4),cex.lab = 1.5, cex.main = 1.4)
}
makeGraphs("wheat3","whitesmoke","sandybrown","seashell")
makeGraphs("wheat3","whitesmoke","sandybrown","seashell")
makeGraphs <- function(color1,color2,color3,color4){
leg <- c("Individual", "Composite") #legend names
par(mfrow=c(2,3))
sites <- c("CPER","DSNY","HARV","OSBS","STER","TALL")
for (i in 1:(length(sites)-1)){
barplot(div[metadataDF$siteIDs==sites[i]],width=0.45,beside = TRUE,ylim=c(5.6,6.25),xlab=sites[i],ylab="Shannon Index",
horiz=F,xpd=F, las=1, col=c(color1,color2),cex.lab = 1.5, cex.main = 1.4)
}
barplot(div[metadataDF$siteIDs==sites[6]],width=0.45,beside = TRUE,ylim=c(5.6,6.25),xlab=sites[6],ylab="Shannon Index",
legend.text = leg, horiz=F,xpd=F, las=1, col=c(color1,color2),cex.lab = 1.5, cex.main = 1.4)
for (i in 1:(length(sites)-1)){
barplot(abundance[metadataDF$siteIDs==sites[i]],width=0.45,beside = TRUE,ylim=c(1590,1760),xlab=sites[i],ylab="Species Richness",
horiz=F,xpd=F, las=1, col=c(color3,color4),cex.lab = 1.5, cex.main = 1.4)
}
barplot(abundance[metadataDF$siteIDs==sites[6]],width=0.45,beside = TRUE,ylim=c(1590,1760),xlab=sites[6],ylab="Species Richness",
legend.text = leg, horiz=F,xpd=F, las=1, col=c(color3,color4),cex.lab = 1.5, cex.main = 1.4)
}
makeGraphs("wheat3","whitesmoke","sandybrown","seashell")
write.csv(div,"diversityMeasures.csv")
write.csv(abundance,"SRmeasures.csv")
